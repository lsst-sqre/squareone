version: 2

updates:
  # npm/pnpm package ecosystem
  - package-ecosystem: 'npm'
    directory: '/'
    schedule:
      interval: 'weekly'
      day: 'monday'
      time: '03:00'
    open-pull-requests-limit: 15
    rebase-strategy: 'auto'
    commit-message:
      prefix: 'chore'
      include: 'scope'

    # Block major version updates globally (manual review required)
    ignore:
      - dependency-name: '*'
        update-types: ['version-update:semver-major']

    registries:
      - npm-github

    groups:
      # Security updates - patch and minor versions (FIRST - highest priority)
      security-patch:
        applies-to: security-updates
        update-types:
          - 'patch'
          - 'minor'
        patterns:
          - '*'

      # React ecosystem
      react:
        patterns:
          - 'react'
          - 'react-dom'
          - '@types/react'
          - '@types/react-dom'

      # Next.js framework and plugins
      nextjs:
        patterns:
          - 'next'
          - '@next/*'
          - 'next-*'
          - 'eslint-config-next'

      # Storybook ecosystem
      storybook:
        patterns:
          - 'storybook'
          - '@storybook/*'
          - 'eslint-plugin-storybook'
          - 'msw'
          - 'msw-storybook-addon'

      # Playwright browser testing
      # (grouped to ensure GitHub Actions is also updated)
      playwright:
        patterns:
          - 'playwright'
          - '@playwright/*'

      # Monorepo infrastructure (Turborepo + Changesets)
      monorepo-infra:
        patterns:
          - 'turbo'
          - '@turbo/*'
          - 'eslint-config-turbo'
          - '@changesets/*'

      # Runtime dependencies (UI, utilities, monitoring)
      runtime:
        patterns:
          - '@radix-ui/*'
          - '@fortawesome/*'
          - '@fontsource/*'
          - 'date-fns'
          - 'date-fns-*'
          - 'react-day-picker'
          - 'remark'
          - 'remark-*'
          - 'next-mdx-remote'
          - '@sentry/*'
          - 'styled-components'
          - 'swr'
          - 'react-hook-form'
          - 'formik'
          - 'react-feather'
          - 'ajv'
          - 'ajv-formats'
          - 'js-yaml'
          - 'react-a11y-disclosure'
          - 'unfetch'
          - '@microsoft/fetch-event-source'

      # Dev dependencies (testing, build, lint, types)
      dev:
        patterns:
          - 'vitest'
          - '@vitest/*'
          - '@testing-library/*'
          - 'vite'
          - '@vitejs/*'
          - 'tsup'
          - 'lightningcss'
          - 'lightningcss-*'
          - 'typescript'
          - '@types/*'
          - 'typescript-plugin-*'
          - 'eslint'
          - 'eslint-config-*'
          - 'eslint-plugin-*'
          - 'style-dictionary'
          - 'style-dictionary-*'
          - '@types/styled-components'
          - '@biomejs/biome'
          - 'husky'
          - 'lint-staged'
          - 'prettier'
          - 'jsdom'
          - 'chromatic'
          - 'babel-loader'
          - 'glob'
          - 'chokidar-cli'
          - 'dotenv'
          - 'lodash'
          - 'yaml'
          - 'new-component'
        exclude-patterns:
          - '@types/react'
          - '@types/react-dom'
          - 'eslint-config-next'
          - 'eslint-config-turbo'
          - 'eslint-plugin-storybook'

      # Catchall for any unlisted development dependencies
      misc-dev:
        dependency-type: 'development'
        patterns:
          - '*'

      # Catchall for any unlisted runtime dependencies
      misc:
        dependency-type: 'production'
        patterns:
          - '*'

  # GitHub Actions updates
  - package-ecosystem: 'github-actions'
    directory: '/'
    schedule:
      interval: 'monthly'
    rebase-strategy: 'auto'
    groups:
      actions:
        patterns:
          - '*'

  # Python dependencies (pip)
  - package-ecosystem: 'pip'
    directory: '/'
    schedule:
      interval: 'weekly'
    rebase-strategy: 'auto'

  # Docker base images
  - package-ecosystem: 'docker'
    directory: '/'
    schedule:
      interval: 'weekly'
    rebase-strategy: 'auto'

registries:
  npm-github:
    type: npm-registry
    url: https://npm.pkg.github.com
    # lsst-sqre org secret (for Dependabot)
    token: ${{ secrets.READONLY_PACKAGES_GITHUB_TOKEN }}
