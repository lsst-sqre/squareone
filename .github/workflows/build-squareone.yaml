name: Build Squareone Docker Image

on:
  workflow_call:
    inputs:
      tag:
        description: 'Tag for image (optional). If not set, tag will be derived from git branch.'
        required: false
        type: string
      push:
        description: 'Push image to registry. Set to false for build-only validation.'
        required: false
        type: boolean
        default: true
    secrets:
      SENTRY_AUTH_TOKEN:
        required: true
      TURBO_TOKEN:
        required: true

jobs:
  build:
    uses: lsst-sqre/multiplatform-build-and-push/.github/workflows/build.yaml@v2
    with:
      images: ghcr.io/${{ github.repository }}
      dockerfile: apps/squareone/Dockerfile
      tag: ${{ inputs.tag }}
      push: ${{ inputs.push }}
    secrets:
      IMAGE_SECRETS: |
        SENTRY_AUTH_TOKEN=${{ secrets.SENTRY_AUTH_TOKEN }}
        TURBO_TOKEN=${{ secrets.TURBO_TOKEN }}
        TURBO_API=${{ vars.TURBO_API }}
        TURBO_TEAM=${{ vars.TURBO_TEAM }}
